using AdventOfCode24.Common;

namespace AdventOfCode24.Day15;

internal class NormalWarehouse(string input) : Warehouse(input)
{
    private const char Box = 'O';

    protected override bool CanRobotMove(Position currentPosition, Direction direction)
    {
        var nextPosition = currentPosition.Move(direction);

        return this[nextPosition] switch
        {
            Wall => false,
            Empty => true,
            Box => CanRobotMove(nextPosition, direction),
            _ => throw new InvalidOperationException($"Unknown character {this[nextPosition]}")
        };
    }

    protected override void Move(Position currentPosition, Direction direction, char previousCharacter)
    {
        while (true)
        {
            var currentCharacter = this[currentPosition];
            this[currentPosition] = previousCharacter;

            if (currentCharacter == Empty)
            {
                return;
            }

            currentPosition = currentPosition.Move(direction);
            previousCharacter = currentCharacter;
        }
    }

    public override int CalculateSumOfBoxesPositions() => CalculateSumOfBoxesPositions(Box);
}